---
import HeaderLink from './HeaderLink.astro'
const { title } = Astro.props
---

<script is:inline>
  function openNav() {
    const dialog = document.getElementById('nav')
    if (!dialog) return

    dialog.showModal()

    // Always start closed (offscreen RIGHT)
    dialog.classList.remove('closing')
    dialog.classList.remove('open')

    const panel = dialog.querySelector('.nav-panel')
    if (!panel) return

    // Force layout so the browser commits the "closed" transform first
    panel.offsetWidth
    dialog.classList.add('open')
  }

  function closeNav() {
    const dialog = document.getElementById('nav')
    if (!dialog) return

    dialog.classList.remove('open')
    dialog.classList.add('closing')

    const panel = dialog.querySelector('.nav-panel')
    if (!panel) {
      dialog.classList.remove('closing')
      dialog.close()
      return
    }

    panel.addEventListener(
      'transitionend',
      () => {
        dialog.classList.remove('closing')
        dialog.close()
      },
      { once: true }
    )
  }
</script>

<header class="grid grid-cols-[1fr_auto_1fr] items-center border-b border-white/10 bg-gray-800">
  <div></div>
  <p class="justify-self-center">{title}</p>
  <button
    class="text-3xl p-4 justify-self-end hover:bg-gray-600"
    onclick="openNav()"
    type="button"
  >
    ☰
  </button>
</header>

<dialog
  id="nav"
  class="fixed inset-0 m-0 p-0 w-screen h-screen max-w-none max-h-none bg-transparent backdrop:bg-black/50"
  onclick="if (event.target === this) closeNav()"
>
  <div class="nav-panel fixed top-0 right-0 h-full w-80 bg-gray-800 border-l border-white/10">
    <button
      class="text-3xl p-4 hover:bg-gray-600"
      onclick="closeNav()"
      type="button"
    >
      ☰
    </button>
    <nav class="mt-2">
      <HeaderLink
        href="/"
        class="nav-link"
        >Home</HeaderLink
      >
      <HeaderLink
        href="/recipes"
        class="nav-link"
        >Recipes</HeaderLink
      >
    </nav>
  </div>
</dialog>

<style>
  /* Closed: offscreen to the RIGHT */
  #nav .nav-panel {
    transform: translateX(100%);
    transition: transform 220ms ease-out;
    will-change: transform;
  }

  /* Open: slide in from RIGHT -> LEFT */
  #nav.open .nav-panel {
    transform: translateX(0);
  }

  /* Closing: slide out to the RIGHT */
  #nav.closing .nav-panel {
    transform: translateX(100%);
  }

  #nav .nav-panel .nav-link {
    display: block;
    width: 100%;
    padding: 12px 16px;
  }

  #nav .nav-panel .nav-link:hover {
    background: rgba(255, 255, 255, 0.06);
  }

  #nav .nav-panel .nav-link.active {
    color: #bfdbfe;
  }
</style>
